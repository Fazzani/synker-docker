{
  "description": "sitepack.ini webgrab",
  "processors": [
    {
      "grok": {
        "field": "message",
        "patterns": [
          "<channel update=\"i\" site=\"%{DATA:site}\" site_id=\"%{DATA:site_id}\" xmltv_id=\"%{DATA:xmltv_id}\">%{DATA:channel_name}</channel>"
        ],
        "ignore_missing": true,
        "ignore_failure" : true
      }
    },
    {
      "set": {
        "field": "_source.unique",
        "value": "{{_source.site_id}}-_-{{_source.xmltv_id}}"
      }
    },
    {
      "set": {
        "field": "update_date",
        "value": "{{_ingest.timestamp}}"
      }
    },
    {
      "set": {
        "field": "id",
        "value": "{{_id}}"
      }
    },
    {
      "script": {
        "inline": "if(ctx.source != null) { ctx.country =  /\\//.split(ctx.source)[4]; } else { ctx.country = '' }"
      },
      "ignore_failure" : true
    },
    {
      "set": {
        "field": "_source.displayNames",
        "value": ["{{_source.channel_name}}"]
      }
    }
  ]
}